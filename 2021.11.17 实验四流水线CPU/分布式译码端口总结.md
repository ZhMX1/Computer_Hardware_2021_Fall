# 分布式译码端口总结

## D阶段译码

只涉及通用寄存器的指令：

源寄存器——执行指令需要用到寄存器里的数据，记为s1，s2，不要的记为0；

一般会用到的有，R型指令从Reg中取数据运算，要通过Reg进行主存地址运算。大概就分两种，一种是指令书上箭头右侧的所有Reg，一种是出现在左侧代表地址的，一般写作base

目的寄存器——执行指令后要把指令的运行结果存进对应的寄存器

一般会用到的有，R型指令数据运算后将结果存入对应的des

1. #### S1_D：取决于D段指令是否把Rs作为源寄存器

   decode对应数据段：21-25，Rs寄存器

   如果Rs是源寄存器之一，则此段要将tunnel连接到或门上，控制MUX选择1的原数据

2. #### S2_D：取决于D段指令是否把Rt作为源寄存器

   decode对应数据段：16-20，Rt寄存器

   如果Rt是源寄存器之一，则此段要将tunnel连接到或门上，控制MUX选择1的原数据

3. #### tuse1_D、tuse2_D

   在后续的EXE(执行计算)、MEM(访问主存)、WB(写回)的三个阶段，还有多久要用到s1、s2（Rs、Rt寄存器）中的数据，如果EXE要用则tuse1_D = 1；如果MEM要用则tuse1_D = 2；如果WB要用则tuse1_D = 3

   一般来说就EXE、MEM会用到源寄存器，到WB阶段就是目的寄存器des了

   **注意**，一定好好看指令中，这个寄存器是Rs还是Rt，比如sw的源是Rt，Rs也是源但是这里不用从它中取数据，Rs作为地址计算直接进入EXE即可，不存在转发问题

4. #### 跳转指令，B型或者J型

   一般在这个阶段后就完成了比较或者操作，然后进入到NPC，后续的分布式译码中应该就没有跳转内容的流水op了

## E阶段分布式译码

到EXE阶段所有的分支和跳转指令都应该执行完毕了，所以S1_E，S2_E都不涉及到beq等指令了

1. #### S1_E：取决于E段指令是否把Rs作为源寄存器

   一般来说和D段保持一致，除去B型指令

2. #### S2_E：取决于E段指令是否把RT作为源寄存器

   同上

3. #### Tnew_E：

   从E段开始还有几个时钟周期，就可以产生写入寄存器的结果，也就是最终结果。这个结果大部分是通过EXE阶段的计算得来的，load指令要在MEM阶段后读出才能写入.

   所以EXE阶段出结果的tnew_E = 1， MEM阶段出结果的tnew_E  = 2

4. #### des_E

   目的寄存器一般分为0000，Rt（16-20）， Rd（11-15）,$31四种， 31专门给jal， Rt, Rd看指令集判断，一般来说是箭头指向方向的出现代号为des_E

5. #### EtoD

   在这个地方准备好的数据一般都是不需要进行运算的，也就是说，跳转地址或者EXTresult



## M阶段分布译码

1. #### S2_M：M阶段是否还要使用S1（Rs）、S2（Rt）寄存器

   在MEM阶段还需要使用源寄存器的指令需要在此处对应加上判断

2. #### des_M

   基本和E阶段保持一致，看指令需要的目的寄存器

3. #### MtoD

   在此处准备好的数据包含大部分，比上一个阶段多了ALUresult，EXTresult基本都转发完了

   注：MtoD中，jal跳转地址为pc+8转回D阶段，其他的转发基本都为EXE后的结果（ALUresult）

## WB阶段分布译码

1. #### des_W

   与M阶段基本保持一致（因为此处设计的寄存器都是为了WB阶段准备的，所以一致）

2. #### WtoD

   比上一个阶段多了RegData，在读取完DM后才有的数据，多用于Load型



# sykDM模块

![image-20211203181052869](C:\Users\zhmx\AppData\Roaming\Typora\typora-user-images\image-20211203181052869.png)

![image-20211203181052869](C:\Users\zhmx\AppData\Roaming\Typora\typora-user-images\image-20211203181052869.png)
